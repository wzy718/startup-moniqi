# 成就规则（对齐 `docs/数值/achievements.csv`）

> 目标：让 `condition_type/condition_value` 与 `reward_type/reward_value` 可被同一套解释器稳定解析，避免后期“每个成就写一段 if”。

---

## 1. 结算时机

- 建议在“每周结算完成后、死亡判定前”检查成就：
  - 这样 `cash`、本周利润、压力/健康等都是最新值
  - 也避免“破产了但本周利润>0”的边界乱序

---

## 2. 条件解释器（condition）

### 2.1 `condition_value` 的通用语法

按优先级解析：

1. 比较表达式：`>=NUM`、`>NUM`、`<=NUM`、`<NUM`、`=NUM`
2. 纯数字：`NUM`
3. 布尔：`true/false`

说明：
- `NUM` 允许整数或小数（如 `5.0`）
- 未匹配到上述格式则视为字符串 token（例如某些“解锁型条件”可用）

### 2.2 `condition_type` 支持列表（与当前 achievements.csv 对齐）

- `cash`：玩家现金（比较/数值）
- `total_asset`：玩家总资产（比较/数值；口径见 `docs/数值/数值类型.md`）
- `weekly_profit`：**店铺利润汇总**（建议映射到 `weekly_profit_total`，比较/数值）
- `profit_streak`：连续盈利周数（数值）
- `shop_count`：同时拥有店铺数（数值）
- `weeks_survived`：累计存活周数（数值）
- `inheritance_count`：完成传承次数（数值）
- `bankruptcy_recovery`：是否“破产后重新盈利”（布尔）
- `max_stress_survived`：压力达到某值且本周未死亡（数值阈值）
- `health_streak`：健康维持在 100 的连续周数（数值）
- `reputation`：声望（比较/数值）
- `shop_rating`：任一店铺评分达到阈值（比较/数值；建议取“当周最高评分”）
- `crisis_handled`：成功处理的舆情危机次数（数值）
- `total_staff_hired`：累计雇佣员工数（数值）
- `staff_tenure`：存在员工在职周数达到阈值（数值）
- `shop_types_tried`：经营过的店铺类型种类数（数值）
- `alien_survived`：外星人事件存活（布尔）
- `ads_watched`：观看广告次数（数值）

### 2.3 需要持久化追踪的统计项（建议放在 player.stats）

- `profit_streak`
- `weeks_survived`
- `inheritance_count`
- `bankruptcy_recovery`（或用状态机：`was_bankrupt_once` + 本周盈利）
- `max_stress_survived`（可由 `stress` 与死亡判定结果更新）
- `health_streak`
- `crisis_handled`
- `total_staff_hired`
- `staff_tenure_max`（或每周扫描员工列表）
- `shop_types_tried_set`
- `alien_survived`
- `ads_watched`

---

## 3. 奖励解释器（reward）

### 3.1 `reward_type` 支持列表（与当前 achievements.csv 对齐）

- `cash`：一次性现金（`reward_value` 为整数）
- `title`：称号（`reward_value` 为字符串）
- `unlock`：解锁内容（`reward_value` 为字符串 key，例如 `inheritance`）
- `stress`：压力一次性变化（`reward_value` 为整数，允许负数）
- `ad_skip`：广告跳过券（`reward_value` 为整数）

以下为“百分比/加成型”奖励（当前 CSV 里已出现，建议统一为永久被动，低强度）：

- `hire_bonus`：招聘质量/成功率加成（`reward_value` 形如 `+20%`）
- `traffic_bonus`：客流加成（`reward_value` 形如 `+10%`）
- `loyalty_bonus`：员工忠诚度成长/上限加成（`reward_value` 形如 `+10%`）
- `hire_cost`：招聘成本修正（`reward_value` 形如 `-20%`）

### 3.2 百分号数值解析

- `+10%` -> `+0.10`
- `-20%` -> `-0.20`

建议落地为玩家永久修正项（例如 `player.mod.traffic_bonus += 0.10`），并在结算公式里统一读取。

---

## 4. 一致性约定（避免歧义）

- `weekly_profit` 在成就语境里统一解释为 **`weekly_profit_total`（店铺利润汇总）**，不是单店利润。
- 成就只解锁一次：达成后标记 `achievement_unlocked[achievement_id]=true`。
