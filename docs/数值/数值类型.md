# 数值类型系统草稿

> 本文档定义游戏中所有数值类型、计算公式、初始值和变化规则

---

## 0. 统一口径（必须遵守）

### 0.1 时间与单位

- **1回合 = 1周**（见 `docs/prd/理念.md` 的循环描述）
- 数值数据表字段字典见：`docs/数值/字段字典.md`
- 金额单位：**元**，默认用**整数**存储（最终结算时取整）
- 概率/倍率：用 **0~1** 的小数或倍率（例如 `1.1` 表示 +10%）
- 月成本折算到周：统一用 `WEEKS_PER_MONTH = 4`（游戏口径，不追求现实精确）

### 0.2 存档值 vs 派生值

- **存档值（state）**：玩家/店铺/员工/世界的“状态”，回合推进需要连续性（例如 `cash`、`stress`、员工列表、flags）。
- **派生值（derived）**：由存档值计算出来的展示/排行/结算结果，不建议落库（例如 `weekly_profit`、`total_asset`）。
- 文档里如果没特别注明，默认“表格里的字段”是存档值；“公式推导出的”是派生值。

### 0.3 命名与命名空间（避免 `rent` 这类冲突）

- 同名字段允许存在，但必须带命名空间理解：
  - `player.cash`、`shop.monthly_rent`、`storefront.monthly_rent`
- 文档里统一把“租金”写成 `monthly_rent`，避免同名冲突；如果实现仍想用 `rent`，也请在代码里加命名空间/结构体字段区分。

### 0.4 每周结算顺序（数值稳定性的关键）

建议每回合固定按以下顺序推进，避免“先后顺序不同导致数值抖动”：

1. **回合开始**：读取存档值（玩家、所有店铺、员工、flags、世界事件持续状态）
2. **生成事件候选**：根据状态从 `docs/数值/events.csv` 过滤并按 `weight` 抽取（可抽 1 个或多个）
3. **玩家选择与检定**：根据 `docs/数值/choices.csv` 应用 `success_rate`（如为空则视为必定成功），并结算 `delta_*` 与 flags 变化
4. **经营结算**：计算每家店的堂食/外卖收入、抽成、固定成本折算到周，得到 `shop.weekly_profit`
5. **玩家结算**：汇总所有店铺利润，扣除 `living_expense` / `family_expense` / 债务利息等，更新 `player.cash`
6. **状态结算**：更新 `stress/health/energy` 等（含自然恢复）
7. **时间推进**：`current_week += 1`；每 52 周 `age += 1`；世界事件持续时间递减
8. **死亡/破产判定**：破产、压力、疾病、年龄等（见第 13 章判定）

## 1. 玩家核心属性

### 1.1 资产类

| 数值名 | 类型 | 初始值 | 范围 | 说明 |
|--------|------|--------|------|------|
| `cash` | 整数 | 100,000 | 0 ~ ∞ | 游戏币/现金，归0则破产 |
| `debt` | 整数 | 0 | 0 ~ ∞ | 负债（贷款等） |

#### 1.1.1 债务附加参数（存档值或全局配置，二选一）

| 数值名 | 类型 | 初始值 | 范围 | 说明 |
|--------|------|--------|------|------|
| `debt_interest_rate_annual` | 浮点 | 0.12 | 0 ~ 1 | 年化利率（用于第 13 章的周利息折算） |
| `debt_weekly_payment` | 整数 | 0 | 0 ~ ∞ | 每周自动还款额（为 0 表示不自动还款） |

### 1.2 状态类

| 数值名 | 类型 | 初始值 | 范围 | 说明 |
|--------|------|--------|------|------|
| `stress` | 整数 | 20 | 0 ~ 100 | 压力值，持续满值(100)会导致死亡 |
| `stress_max_weeks` | 整数 | 0 | 0 ~ ∞ | 压力满值持续周数，达到阈值(如4周)触发死亡 |
| `health` | 整数 | 100 | 0 ~ 100 | 健康值，影响疾病概率和工作效率 |
| `age` | 整数 | 25 | 18 ~ 100 | 年龄，每52周+1岁，到达上限去世 |
| `energy` | 整数 | 100 | 0 ~ 100 | 精力值，影响每周可做的事情数量 |

### 1.3 社会属性

| 数值名 | 类型 | 初始值 | 范围 | 说明 |
|--------|------|--------|------|------|
| `reputation` | 整数 | 50 | 0 ~ 100 | 社会声望，影响贷款额度、招聘难度 |
| `relationship_status` | 枚举 | single | - | 婚恋状态：single/dating/married/divorced |
| `has_children` | 布尔 | false | - | 是否有孩子，影响继承系统 |
| `children_count` | 整数 | 0 | 0 ~ 5 | 孩子数量 |
| `living_expense` | 整数 | 2000 | 1000 ~ ∞ | 每周生活费，随生活状态变化 |

### 1.4 玩家派生值（不建议存档）

| 数值名 | 类型 | 说明 |
|--------|------|------|
| `weekly_profit_total` | 整数 | 所有店铺本周利润汇总（不含玩家生活/家庭/债务） |
| `weekly_net_cashflow` | 整数 | 玩家本周净现金流（店铺利润汇总 - 生活/家庭/债务 - 事件现金变化） |
| `total_asset` | 整数 | 总资产（`cash` + 店铺估值 - `debt`）；店铺估值口径见 3.3（可先用简化估值） |

---

## 2. 人物性格系统（MBTI）

> 开局时用户可以**手动输入 MBTI 类型**或**随机生成**，影响整个游戏的事件触发和数值变化
>
> 建议把 MBTI 的“数值效果”统一放在 `docs/数值/mbti.csv`，本文档更多描述结构与用法，避免两处手填导致不一致。

### 2.1 MBTI 输入方式

| 方式 | 说明 |
|------|------|
| 手动输入 | 用户已知自己的 MBTI，直接选择 4 个字母 |
| 随机生成 | 系统随机生成一个 MBTI 类型 |
| 简易测试 | （可选）4道快速问题确定 E/I、S/N、T/F、J/P |

### 2.2 MBTI 四维度定义

| 维度 | 选项A | 选项B | 影响领域 |
|------|-------|-------|----------|
| 能量来源 | E（外向） | I（内向） | 社交、招聘、谈判 |
| 信息获取 | S（实感） | N（直觉） | 风险判断、机会发现 |
| 决策方式 | T（思考） | F（情感） | 员工管理、客户关系 |
| 生活方式 | J（判断） | P（知觉） | 计划性、应变能力 |

### 2.3 MBTI 16 种性格类型

#### 分析家组（NT）

| MBTI | 名称 | 描述 | 初始加成 | 特殊效果 |
|------|------|------|----------|----------|
| `INTJ` | 建筑师 | 战略思维，独立自主 | cash+15000, stress+5 | 长期规划收益+15%，但社交事件成功率-10% |
| `INTP` | 逻辑学家 | 善于分析，追求创新 | energy+10 | 调研成本-30%，揭示隐藏属性更准确 |
| `ENTJ` | 指挥官 | 天生领导，果断决策 | reputation+15, cash+10000 | 员工效率+15%，但员工离职时损失更大 |
| `ENTP` | 辩论家 | 思维敏捷，喜欢挑战 | stress-10 | 谈判议价+20%，但容易触发争议事件 |

#### 外交家组（NF）

| MBTI | 名称 | 描述 | 初始加成 | 特殊效果 |
|------|------|------|----------|----------|
| `INFJ` | 提倡者 | 理想主义，洞察人心 | health+10 | 员工忠诚度+20%，客户好评率+10% |
| `INFP` | 调停者 | 富有同情，追求意义 | stress-5, health+5 | 压力恢复速度+30%，但财务决策收益-10% |
| `ENFJ` | 主人公 | 魅力领袖，激励他人 | reputation+20 | 招聘成功率+25%，员工士气上限+10 |
| `ENFP` | 竞选者 | 热情洋溢，创意无限 | energy+15, stress-5 | 营销效果+20%，但成本控制-10% |

#### 哨兵组（SJ）

| MBTI | 名称 | 描述 | 初始加成 | 特殊效果 |
|------|------|------|----------|----------|
| `ISTJ` | 物流师 | 可靠务实，一丝不苟 | cash+20000 | 成本控制+15%，卫生评分+10，但创新事件收益-15% |
| `ISFJ` | 守卫者 | 尽职尽责，温暖体贴 | health+10, stress-5 | 员工满意度+15%，老顾客复购率+20% |
| `ESTJ` | 总经理 | 高效执行，组织能力强 | cash+10000, reputation+10 | 多店管理效率+20%，但灵活应变-15% |
| `ESFJ` | 执政官 | 热心助人，重视和谐 | reputation+15 | 社区关系+25%，员工士气恢复+20% |

#### 探险家组（SP）

| MBTI | 名称 | 描述 | 初始加成 | 特殊效果 |
|------|------|------|----------|----------|
| `ISTP` | 鉴赏家 | 冷静观察，动手能力强 | energy+10 | 设备维修成本-30%，危机处理+20% |
| `ISFP` | 探险家 | 灵活艺术，享受当下 | stress-10, health+5 | 店铺装修吸引力+15%，但长期规划收益-10% |
| `ESTP` | 企业家 | 精力充沛，敢于冒险 | cash+15000, stress-5 | 高风险事件收益+25%，但损失也+15% |
| `ESFP` | 表演者 | 活力四射，社交达人 | reputation+20, energy+10 | 促销活动效果+30%，但日常运营效率-10% |

### 2.4 四维度独立影响

> 除了16种完整性格的效果，每个维度字母也有独立加成

| 维度 | 效果 |
|------|------|
| **E（外向）** | 社交事件成功率+10%，招聘速度+1周，但独处时压力恢复-20% |
| **I（内向）** | 独处时压力恢复+20%，分析判断准确+10%，但社交事件成功率-10% |
| **S（实感）** | 日常运营效率+10%，成本控制+5%，但发现新机会概率-10% |
| **N（直觉）** | 发现新机会概率+15%，创新事件收益+10%，但细节失误率+5% |
| **T（思考）** | 财务决策收益+10%，谈判理性+15%，但员工关系维护-10% |
| **F（情感）** | 员工忠诚度+10%，客户满意度+10%，但可能做出非理性让步 |
| **J（判断）** | 计划执行效率+15%，长期收益+10%，但突发事件应变-15% |
| **P（知觉）** | 突发事件应变+20%，灵活调整+15%，但长期计划收益-10% |

### 2.5 性格影响因子（代码）

```javascript
// 建议把“MBTI 数值”落在数据表而不是硬编码：
// - 16种类型：docs/数值/mbti.csv
// - 如果未来要拆成四维度，也建议用表驱动 + 乘法/加法合并规则

function getMBTIStats(mbti) {
  // 读取 docs/数值/mbti.csv 对应行：包含 delta_* 与若干倍率字段
  return mbtiRow
}

function applyMBTIBase(player, mbtiRow) {
  // 开局一次性 delta（加法）
  player.cash += mbtiRow.delta_cash
  player.stress += mbtiRow.delta_stress
  player.health += mbtiRow.delta_health
  player.energy += mbtiRow.delta_energy
  player.reputation += mbtiRow.delta_reputation

  // 回合内使用的修正（乘法/加法混合，规则要写死）
  // 例：倍率字段默认 1.0；招聘速度字段按“减少周数”的加法处理
  player.mod.social_success *= mbtiRow.social_success
  player.mod.stress_recovery *= mbtiRow.stress_recovery
  player.mod.analysis_accuracy *= mbtiRow.analysis_accuracy
  player.mod.cost_control *= mbtiRow.cost_control
  player.mod.opportunity_discovery *= mbtiRow.opportunity_discovery
  player.mod.financial_decision *= mbtiRow.financial_decision
  player.mod.staff_loyalty *= mbtiRow.staff_loyalty
  player.mod.customer_satisfaction *= mbtiRow.customer_satisfaction
  player.mod.plan_efficiency *= mbtiRow.plan_efficiency
  player.mod.emergency_response *= mbtiRow.emergency_response
  player.mod.hire_time_delta_weeks -= mbtiRow.hire_speed
}
```

### 2.6 MBTI 与事件关联

> 某些事件只对特定 MBTI 触发或有特殊选项

| 事件类型 | 相关 MBTI | 说明 |
|----------|-----------|------|
| 员工矛盾调解 | F 型优势 | F 型有额外和解选项 |
| 投资机会判断 | N 型优势 | N 型能看到隐藏收益 |
| 危机公关 | E 型优势 | E 型处理速度更快 |
| 成本审计 | S/T 型优势 | 发现更多节省空间 |
| 突发状况 | P 型优势 | 有更多灵活应对选项 |
| 长期合作谈判 | J 型优势 | 获得更好的长期条款 |

---

## 3. 店铺属性系统

### 3.1 店铺基础属性

| 数值名 | 类型 | 范围 | 说明 |
|--------|------|------|------|
| `shop_id` | 字符串 | - | 店铺唯一ID |
| `shop_type` | 枚举 | - | 店铺类型（见3.2） |
| `shop_name` | 字符串 | - | 店铺名称 |
| `operation_mode` | 枚举 | original/franchise | 原创/加盟 |
| `brand_id` | 字符串 | - | 加盟品牌ID（原创则为空） |
| `open_week` | 整数 | - | 开业的周数 |
| `shop_level` | 整数 | 1~10 | 店铺等级，影响收入上限 |

### 3.2 店铺类型定义

> 建议以 `docs/数值/shop_types.csv` 为唯一数据源；本表用于展示策划口径与示例。

| 类型ID | 名称 | 启动成本 | 日常成本 | 收入潜力 | 上手难度 | 说明 |
|--------|------|----------|----------|----------|----------|------|
| `milk_tea` | 奶茶店 | 80,000~150,000 | 中 | 中高 | 低 | 年轻人最爱，竞争激烈 |
| `noodle` | 面馆 | 60,000~120,000 | 中 | 中 | 中 | 刚需品类，稳定客群 |
| `bbq` | 烧烤店 | 100,000~200,000 | 高 | 高 | 高 | 夜宵王者，季节波动大 |
| `cafe` | 咖啡店 | 120,000~250,000 | 中高 | 中高 | 中 | 文艺范，需要选址 |
| `snack` | 小吃店 | 30,000~80,000 | 低 | 低中 | 低 | 门槛低，流动性大 |
| `hotpot` | 火锅店 | 150,000~350,000 | 高 | 高 | 高 | 翻台率关键，资金要求高 |
| `bakery` | 烘焙店 | 100,000~200,000 | 中 | 中高 | 中高 | 技术门槛，保质期短 |
| `fast_food` | 快餐店 | 80,000~180,000 | 中 | 中 | 中 | 效率为王，标准化要求高 |

### 3.3 店铺经营数值

| 数值名 | 类型 | 范围 | 说明 |
|--------|------|------|------|
| `daily_customers` | 整数 | 0 ~ ∞ | 日均客流量 |
| `avg_ticket` | 整数 | 0 ~ ∞ | 客单价（元） |
| `open_days_per_week` | 整数 | 1 ~ 7 | 每周营业天数 |
| `delivery_avg_ticket` | 整数 | 0 ~ ∞ | 外卖客单价（元） |
| `daily_revenue` | 整数 | 0 ~ ∞ | 日营业额 = daily_customers × avg_ticket |
| `weekly_revenue` | 整数 | 0 ~ ∞ | 周营业额（派生）= daily_revenue × open_days_per_week × 季节/节假日系数 |
| `gross_margin` | 浮点 | 0 ~ 1 | 毛利率 |
| `weekly_profit` | 整数 | -∞ ~ ∞ | 周净利润（派生，见第 13 章） |
| `shop_rating` | 浮点 | 1.0 ~ 5.0 | 店铺评分（影响客流） |
| `hygiene_score` | 整数 | 0 ~ 100 | 卫生评分（影响检查事件） |

### 3.4 店铺成本结构

> 本节统一“毛利率/原料成本/平台抽成”的口径，避免双算。

#### 3.4.1 固定成本（按月口径，结算时折算到周）

| 数值名 | 类型 | 说明 |
|--------|------|------|
| `monthly_rent` | 整数 | 月租金（来源：门面选择/续约/涨租事件） |
| `monthly_labor_cost` | 整数 | 月人工成本（由员工 `salary` 汇总得到） |
| `monthly_utility_cost` | 整数 | 月水电燃气（可用店铺类型基础值 + 随机波动） |
| `monthly_marketing_cost` | 整数 | 月营销费用（促销、投放等） |
| `monthly_brand_fee` | 整数 | 加盟固定月费（对应 `docs/数值/brands.csv:monthly_fee`；原创为 0） |
| `monthly_other_cost` | 整数 | 月其他费用（耗材、维修等） |

#### 3.4.2 变动成本（随营业额变化）

- **原料/损耗等成本**：由 `gross_margin` 统一表达，结算时 `cogs = revenue × (1 - gross_margin)`；不要再额外叠加一条“原料成本率 × revenue”导致双算。
- **外卖平台抽成**：由外卖平台的 `commission_rate` 决定，结算时 `commission = delivery_revenue × commission_rate`。
- 其他可选项（后续再细化）：包材单、配送补贴、活动补贴等（建议都归入外卖侧的“变动成本”）。

---

## 4. 门面属性系统

> 开局选择门面时随机生成

### 4.1 门面基础属性

| 数值名 | 类型 | 范围 | 可见性 | 说明 |
|--------|------|------|--------|------|
| `location_id` | 枚举 | - | 可见 | 位置类型ID（见4.2 / `docs/数值/locations.csv`） |
| `spot_tier` | 枚举 | core/normal/poor | **隐藏** | 同一位置类型里的“点位优劣”，影响租金与真实客流（由 `docs/数值/locations.csv` 的 core/poor 概率生成） |
| `spot_display` | 枚举 | - | 可见 | 点位展示：核心位/普通位/边角位（由 `spot_tier` 映射，用于让玩家直观看到“位置好坏”） |
| `area` | 整数 | 20~500 m² | 可见 | 面积 |
| `monthly_rent` | 整数 | 3000~50000 | 可见 | 月租金 |
| `deposit_months` | 整数 | 1~6 | 可见 | 押金月数 |
| `lease_years` | 整数 | 1~5 | 可见 | 租约年限 |
| `decoration_status` | 枚举 | - | 可见 | 装修状态：blank/simple/good |
| `foot_traffic` | 整数 | 1~100000 | **隐藏** | 真实人流量指数 |
| `foot_traffic_display` | 枚举 | - | 可见 | 人流量展示： 夯/顶级/人上人/NPC/拉完了（模糊） |
| `competition_index` | 整数 | 1~100 | **隐藏** | 周边竞争指数 |
| `landlord_attitude` | 整数 | 1~100 | **隐藏** | 房东态度（影响续约涨租） |
| `hidden_problem` | 枚举 | - | **隐藏** | 隐藏问题：none/leak/noise/smell/haunted |
| `growth_potential` | 整数 | 1~100 | **隐藏** | 区域发展潜力 |

### 4.2 位置类型定义

> 建议以 `docs/数值/locations.csv` 为唯一数据源；本表用于展示策划口径与示例。

补充：为了表现“核心位置/差位置”的差异，门面会生成一个隐藏字段 `spot_tier`（core/normal/poor）。对应的分布与倍率修正放在 `docs/数值/locations.csv`：

建议映射关系（实现时写死）：

| `spot_tier` | `spot_display` |
|------------|-----------------|
| core | 核心位 |
| normal | 普通位 |
| poor | 边角位 |

| 字段 | 说明 |
|------|------|
| `core_spot_chance/poor_spot_chance` | 生成 core/poor 的概率；剩余概率为 normal |
| `core_rent_mult/core_traffic_mult` | core 点位对租金/客流的倍率修正 |
| `poor_rent_mult/poor_traffic_mult` | poor 点位对租金/客流的倍率修正 |

| 位置ID | 名称 | 租金系数 | 人流系数 | 特点 |
|--------|------|----------|----------|------|
| `mall` | 商场店 | 1.5 | 1.3 | 人流稳定，租金高，有营业时间限制 |
| `street` | 街边店 | 1.0 | 1.0 | 灵活度高，受天气影响 |
| `community` | 社区店 | 0.7 | 0.8 | 租金低，客群固定，复购率高 |
| `office` | 写字楼 | 1.2 | 1.1 | 工作日好，周末差，客单价高 |
| `school` | 学校周边 | 0.9 | 1.2 | 寒暑假冷清，学生消费力有限 |
| `station` | 车站/地铁 | 1.4 | 1.4 | 人流大但停留短，适合快餐 |
| `scenic` | 景区/商圈 | 1.6 | 1.5 | 节假日爆发，平日冷清 |

### 4.3 调研系统

| 调研方式 | 花费 | 时间消耗 | 可揭示属性 |
|----------|------|----------|------------|
| 蹲点观察 | 0 | 1周 | foot_traffic |
| 问周边商家 | 500 | 1周 | competition_index, landlord_attitude, spot_tier |
| 找中介打听 | 2000 | 0 | hidden_problem, growth_potential |
| 专业调研 | 5000 | 0 | 全部隐藏属性 |
| 看广告 | 广告 | 0 | 全部隐藏属性 |

---

## 5. 品牌/加盟系统

### 5.1 品牌属性

> 建议以 `docs/数值/brands.csv` 为唯一数据源。

| 数值名 | 类型 | 范围 | 说明 |
|--------|------|------|------|
| `brand_id` | 字符串 | - | 品牌ID |
| `brand_name` | 字符串 | - | 品牌名称 |
| `brand_type` | 枚举 | - | 对应店铺类型 |
| `brand_tier` | 枚举 | S/A/B/C | 品牌档次 |
| `franchise_fee` | 整数 | 10000~500000 | 加盟费 |
| `royalty_rate` | 浮点 | 0~0.15 | 营业额抽成比例 |
| `monthly_fee` | 整数 | 0~10000 | 固定月费 |
| `brand_awareness` | 整数 | 1~100 | 品牌知名度 |
| `supply_chain_score` | 整数 | 1~100 | 供应链评分 |
| `training_quality` | 整数 | 1~100 | 培训质量 |
| `territory_protection` | 布尔 | - | 是否有区域保护 |
| `menu_freedom` | 整数 | 1~100 | 菜单自由度 |
| `support_level` | 整数 | 1~100 | 总部支持力度 |

### 5.2 加盟 vs 原创对比

| 维度 | 加盟 | 原创 |
|------|------|------|
| 启动成本 | 高（含加盟费） | 低 |
| 品牌效应 | 有（取决于品牌） | 无（需自建） |
| 经营自由度 | 低 | 高 |
| 供应链 | 总部提供 | 自己找 |
| 培训支持 | 有 | 无 |
| 持续费用 | 有（抽成+月费） | 无 |
| 风险 | 较低（有模式） | 较高（探索期） |

### 5.3 自建品牌系统

> 经营到一定阶段可创建自己的品牌

| 数值名 | 解锁条件 | 说明 |
|--------|----------|------|
| `can_create_brand` | 累计盈利 > 500,000 且 经营 > 52周 | 可以创建品牌 |
| `own_brand_level` | - | 自有品牌等级 1~10 |
| `franchisee_count` | - | 加盟商数量 |
| `franchise_income` | - | 加盟收入 |

---

## 6. 员工系统

### 6.1 员工基础属性

| 数值名 | 类型 | 范围 | 可见性 | 说明 |
|--------|------|------|--------|------|
| `staff_id` | 字符串 | - | - | 员工ID |
| `name` | 字符串 | - | 可见 | 姓名 |
| `position_id` | 枚举 | - | 可见 | 职位ID（见6.2 / `docs/数值/positions.csv`） |
| `salary` | 整数 | 2000~20000 | 可见 | 期望月薪 |
| `skill` | 整数 | 1~100 | **部分** | 技能水平（显示为：差/中/良/优） |
| `experience` | 整数 | 0~20 | 可见 | 从业年限 |
| `loyalty` | 整数 | 1~100 | **隐藏** | 忠诚度 |
| `stability` | 整数 | 1~100 | **隐藏** | 稳定性（离职倾向） |
| `personality` | 枚举 | - | **隐藏** | 性格特征 |
| `hidden_skill` | 枚举 | - | **隐藏** | 隐藏技能/缺点 |

### 6.2 职位定义

> 建议以 `docs/数值/positions.csv` 为唯一数据源；本表用于展示策划口径与示例。

| 职位ID | 名称 | 基础薪资范围 | 技能要求 | 说明 |
|--------|------|--------------|----------|------|
| `chef` | 厨师/调饮师 | 4000~12000 | 高 | 核心岗位，影响出品质量 |
| `barista` | 咖啡师 | 4500~10000 | 高 | 咖啡店核心岗位 |
| `waiter` | 服务员 | 3000~5000 | 低 | 影响服务评分 |
| `cashier` | 收银员 | 3000~5000 | 低 | 影响结账效率 |
| `cleaner` | 保洁 | 2500~4000 | 低 | 影响卫生评分 |
| `manager` | 店长 | 6000~15000 | 高 | 可托管店铺，降低玩家压力 |
| `delivery` | 配送员 | 4000~8000 | 中 | 自配送时需要 |

### 6.3 员工状态数值

| 数值名 | 类型 | 范围 | 说明 |
|--------|------|------|------|
| `morale` | 整数 | 0~100 | 士气，影响工作效率和离职率 |
| `fatigue` | 整数 | 0~100 | 疲劳度，过高会请假或离职 |
| `tenure_weeks` | 整数 | 0~∞ | 在职周数 |
| `performance` | 整数 | 0~100 | 绩效评分 |

### 6.4 招聘数值

| 数值名 | 说明 |
|--------|------|
| `hire_cost` | 招聘成本（中介费/广告费） |
| `hire_time` | 招聘耗时（周） |
| `applicant_quality` | 应聘者质量（受店铺声望、薪资影响） |

---

## 7. 外卖系统

### 7.1 外卖平台属性

| 数值名 | 类型 | 范围 | 说明 |
|--------|------|------|------|
| `platform_id` | 枚举 | meituan/eleme/douyin | 平台类型 |
| `is_active` | 布尔 | - | 是否开通 |
| `commission_rate` | 浮点 | 0.15~0.25 | 平台抽成比例 |
| `platform_fixed_monthly_fee` | 整数 | 0~10000 | 平台固定月服务费（如有） |
| `delivery_mode` | 枚举 | platform/self/hybrid | 配送方式 |
| `online_rating` | 浮点 | 1.0~5.0 | 线上评分 |
| `weekly_orders` | 整数 | 0~∞ | 周订单量（回合结算口径） |
| `avg_delivery_time` | 整数 | 15~60 | 平均配送时间（分钟） |
| `weekly_promo_budget` | 整数 | 0~∞ | 周推广预算（回合结算口径） |

### 7.2 外卖经营数值

| 数值名 | 计算公式 | 说明 |
|--------|----------|------|
| `delivery_revenue` | 周订单量 × 外卖客单价 | 外卖营业额（周口径） |
| `delivery_commission` | delivery_revenue × commission_rate | 平台抽成（周口径） |
| `delivery_cost` | delivery_commission + weekly_promo_budget + 其他变动成本 | 外卖成本（周口径，简化） |
| `delivery_profit` | delivery_revenue - delivery_cost | 外卖利润 |
| `delivery_ratio` | 外卖营业额 / 总营业额 | 外卖占比 |

---

## 8. 时间与事件系统

### 8.1 时间数值

| 数值名 | 类型 | 说明 |
|--------|------|------|
| `current_week` | 整数 | 当前周数（从1开始） |
| `current_year` | 整数 | 当前年份 |
| `season` | 枚举 | spring/summer/autumn/winter |
| `is_holiday` | 布尔 | 是否节假日 |
| `holiday_type` | 枚举 | 节日类型（影响客流） |

### 8.2 事件触发条件

本项目建议以 `docs/数值/events.csv` 为**事件触发的唯一数据源**，字段含义如下（与文档口径对齐）：

| 字段 | 含义 |
|------|------|
| `week_min/week_max` | 允许出现的周数范围 |
| `weight` | 权重（在候选事件池里做加权抽取） |
| `shop_type` | 限定店铺类型（空表示不限） |
| `operation_mode` | 限定原创/加盟（空表示不限） |
| `required_flags/excluded_flags` | flags 条件（用 `|` 分隔） |
| `cash_min/cash_max` | 玩家现金范围（周初状态） |
| `stress_min/stress_max` | 玩家压力范围（周初状态） |
| `season` | 季节限定（空表示不限） |
| `mbti_advantage` | 该事件在某维度/类型上有优势（用于提升成功率或解锁选项） |

事件流程建议：

1. 用上述条件过滤得到候选事件集合
2. 按 `weight` 做加权随机抽取事件（可抽 1 个/多个）
3. 用 `docs/数值/choices.csv` 按 `event_id` 拉取该事件的所有选项
4. 玩家选择后，应用 `delta_*` 与 flags 变化；如存在 `followup_event_id` 则进入事件链

### 8.3 事件影响数值

| 影响类型 | 数值字段 | 说明 |
|----------|----------|------|
| 资金变化 | `delta_cash` | 正负皆可 |
| 压力变化 | `delta_stress` | 正负皆可 |
| 声望变化 | `delta_reputation` | 正负皆可 |
| 健康变化 | `delta_health` | 正负皆可 |
| 评分变化 | `delta_rating` | 正负皆可 |
| 员工士气 | `delta_morale` | 正负皆可 |
| 添加标记 | `adds_flags` | 事件链触发 |
| 移除标记 | `removes_flags` | 事件链控制 |

#### 8.3.1 选项检定字段（对齐 `docs/数值/choices.csv`）

| 字段 | 说明 |
|------|------|
| `success_rate` | 成功概率（为空表示必定成功；失败分支可用 `followup_event_id` 接后续事件） |
| `mbti_bonus` | MBTI 优势标记（如 `E/S/T/F/N/J/P`），用于对 `success_rate` 或选项解锁做修正 |
| `notes` | 策划备注（不参与数值计算） |

---

## 9. 继承系统

### 9.1 家庭数值

| 数值名 | 类型 | 范围 | 说明 |
|--------|------|------|------|
| `spouse_id` | 字符串 | - | 配偶ID |
| `spouse_support` | 整数 | 0~100 | 配偶支持度（影响压力恢复） |
| `family_expense` | 整数 | 0~∞ | 家庭支出增量 |

### 9.2 子女属性

| 数值名 | 类型 | 范围 | 说明 |
|--------|------|------|------|
| `child_id` | 字符串 | - | 子女ID |
| `child_age` | 整数 | 0~∞ | 子女年龄 |
| `child_personality` | 枚举 | - | 随机性格（继承时使用） |
| `child_interest` | 整数 | 0~100 | 对接班的兴趣 |
| `child_skill` | 整数 | 0~100 | 经营能力（可培养） |

### 9.3 继承条件

| 条件 | 数值要求 |
|------|----------|
| 触发年龄 | 玩家 age >= 60 |
| 有子女 | has_children = true |
| 子女成年 | child_age >= 18 |
| 子女意愿 | child_interest >= 50 |

### 9.4 继承后数值重置

| 数值 | 继承规则 |
|------|----------|
| `age` | 重置为子女年龄（18~25） |
| `personality` | 使用子女性格 |
| `cash` | 继承父辈现金的 80% |
| `stress` | 重置为 30 |
| `health` | 重置为 100 |
| 店铺 | 全部继承 |
| 员工 | 保留，但忠诚度-20 |
| 声望 | 继承 50% |

---

## 10. 世界事件系统

### 10.1 世界事件类型

世界事件建议以 `docs/数值/world_events.csv` 为唯一数据源，本文给出字段口径示例：

| 事件ID | 名称 | 概率 | 影响范围 | 持续时间（周） | 说明 |
|--------|------|------|----------|----------------|------|
| `WE001` | 疫情爆发 | 0.005 | global | 8~24 | 堂食受限，外卖爆发 |
| `WE002` | 地震 | 0.002 | regional | 2~8 | 可能损坏店铺设备 |
| `WE003` | 经济危机 | 0.01 | global | 24~104 | 消费力整体下降 |
| `WE004` | 食品安全丑闻 | 0.02 | category | 4~12 | 特定品类信任危机 |

### 10.2 世界事件影响

`docs/数值/world_events.csv` 已补充结构化字段，建议实现时**优先使用结构化列**（旧字段保留用于回溯/策划备注）：

- 客流/客单：`dine_in_traffic_mult`、`delivery_traffic_mult`、`avg_ticket_mult`
- 成本：`labor_cost_mult`、`cogs_cost_mult`、`weekly_fixed_cost_add`、`one_time_cost_add`
- 特殊：`forced_close_chance`、`shop_damage_chance`、`rating_delta`、`competition_index_delta`、`category_trust_delta`、`world_flags_add`

旧字段（legacy）：`traffic_modifier/cost_modifier/special_effect`（不建议新内容继续依赖字符串解析）

世界事件触发、作用范围、叠加与解释规则见：`docs/数值/世界事件规则.md`

---

## 11. 成就系统数值

### 11.1 成就追踪数值

| 数值名 | 类型 | 说明 |
|--------|------|------|
| `total_revenue_earned` | 整数 | 累计营业额 |
| `total_profit_earned` | 整数 | 累计净利润 |
| `total_weeks_survived` | 整数 | 累计存活周数 |
| `total_shops_owned` | 整数 | 累计拥有店铺数 |
| `total_staff_hired` | 整数 | 累计雇佣员工数 |
| `total_events_faced` | 整数 | 累计经历事件数 |
| `bankruptcy_count` | 整数 | 破产次数 |
| `max_cash_reached` | 整数 | 现金峰值 |
| `max_shops_at_once` | 整数 | 同时拥有店铺峰值 |
| `generations_count` | 整数 | 传承代数 |

> 说明：为避免歧义，成就/排行里出现的 `weekly_profit` 建议统一指玩家侧的 `weekly_profit_total`（店铺利润汇总），而不是单店的 `shop_weekly_profit`。

成就条件与奖励的解释器规则见：`docs/数值/成就规则.md`

### 11.2 成就解锁示例

成就建议以 `docs/数值/achievements.csv` 为唯一数据源，本文仅列举部分示例：

| 成就ID | 名称 | 条件（示例） | 奖励（示例） |
|--------|------|--------------|--------------|
| `A001` | 第一桶金 | `weekly_profit > 0` | `unlock: new_game_mode` |
| `A002` | 站稳脚跟 | `profit_streak = 4` | `cash +5000` |
| `A005` | 百万富翁 | `cash >= 1000000` | `title: 百万富翁` |
| `A012` | 十年传奇 | `weeks_survived = 520` | `unlock: inheritance` |
| `A024` | 外星友人 | `alien_survived = true` | `title: 星际商人` |

---

## 12. 排行系统数值

### 12.1 排行榜类型

| 排行榜 | 排序依据 | 说明 |
|--------|----------|------|
| 财富榜 | `total_asset` | 当前总资产排名 |
| 存活榜 | `total_weeks_survived` | 存活时间排名 |
| 传奇榜 | `generations_count` | 传承代数排名 |
| 周榜 | `weekly_profit_total` | 本周店铺利润汇总排名（不含生活费等玩家侧支出） |

### 12.2 排名奖励

| 排名 | 奖励 |
|------|------|
| Top 1 | 专属头衔 + 100广告跳过券 |
| Top 10 | 50广告跳过券 |
| Top 100 | 10广告跳过券 |

---

## 13. 数值公式汇总

### 13.1 收入计算

```
WEEKS_PER_MONTH = 4

// 单店堂食：日营业额
dine_in_daily_revenue = daily_customers × avg_ticket

// 单店堂食：周营业额（回合口径）
dine_in_weekly_revenue = dine_in_daily_revenue
                      × open_days_per_week
                      × season_modifier
                      × holiday_modifier

// 单店外卖：周营业额（回合口径）
delivery_revenue = weekly_orders × delivery_avg_ticket

// 单店总周营业额
shop_weekly_revenue = dine_in_weekly_revenue + delivery_revenue

// 全部店铺总周营业额
total_weekly_revenue = Σ(each_shop.shop_weekly_revenue)
```

### 13.2 成本计算

```
// 单店周固定成本（把月口径折算到周）
shop_weekly_fixed_cost =
  (monthly_rent + monthly_labor_cost + monthly_utility_cost
   + monthly_marketing_cost + monthly_brand_fee + monthly_other_cost) / WEEKS_PER_MONTH

// 单店周原料/损耗等变动成本（由毛利率统一表达）
shop_weekly_cogs = shop_weekly_revenue × (1 - gross_margin)

// 单店周外卖成本（抽成 + 推广预算 + 平台固定费折算；其余后续再细化）
shop_weekly_delivery_cost =
  delivery_revenue × commission_rate
  + weekly_promo_budget
  + platform_fixed_monthly_fee / WEEKS_PER_MONTH

// 单店总周成本
shop_weekly_cost = shop_weekly_fixed_cost + shop_weekly_cogs + shop_weekly_delivery_cost

// 玩家侧总周成本（生活/家庭等）
player_weekly_personal_cost = living_expense + family_expense

// 债务周成本（简化：利息 + 还款；还款会减少 debt）
debt_weekly_interest = floor(debt * debt_interest_rate_annual / 52)
debt_weekly_payment_actual = clamp(debt_weekly_payment, 0, debt)
```

### 13.3 利润计算

```
// 单店周利润
shop_weekly_profit = shop_weekly_revenue - shop_weekly_cost

// 店铺利润汇总（派生值）
weekly_profit_total = Σ(each_shop.shop_weekly_profit)

// 玩家本周净现金流（派生值）
weekly_net_cashflow =
  weekly_profit_total
  - player_weekly_personal_cost
  - debt_weekly_interest
  - debt_weekly_payment_actual
  + event_delta_cash

// 玩家现金更新（存档值）
cash = cash + weekly_net_cashflow

// 玩家债务更新（存档值）
debt = debt + debt_weekly_interest - debt_weekly_payment_actual
```

### 13.4 压力计算

```
// 周压力变化
stress_delta = base_stress_change
             + (cash < 10000 ? 10 : 0)           // 缺钱焦虑
             + (staff_shortage ? 5 : 0)          // 缺人焦虑
             + (bad_rating ? 5 : 0)              // 差评焦虑
             + event_delta_stress                // 事件影响
             - (has_manager ? 5 : 0)             // 店长减压
             - (spouse_support / 10)             // 配偶减压
             
// 压力恢复（每周自然恢复）
natural_stress_recovery = 5 × (health / 100)

// 最终压力
stress = clamp(stress + stress_delta - natural_stress_recovery, 0, 100)
```

### 13.5 健康计算

```
// 周健康变化
health_delta = -1                                // 自然老化
             - (stress > 80 ? 2 : 0)            // 高压损耗
             - (age > 50 ? 1 : 0)               // 年龄加速
             + event_delta_health
             
// 疾病概率（每周检定）
illness_probability = (100 - health) / 500 + stress / 500
```

### 13.6 死亡判定

```
// 破产死亡
if (cash <= 0) trigger_death("bankruptcy")

// 压力死亡
if (stress >= 100) stress_max_weeks++
else stress_max_weeks = 0
if (stress_max_weeks >= 4) trigger_death("stress")

// 年龄死亡
if (age >= 85) {
  death_probability = (age - 85) × 0.1
  if (random() < death_probability) trigger_death("age")
}

// 疾病死亡
if (random() < illness_probability && health < 20) {
  trigger_death("illness")
}
```

---

## 14. 数值平衡参考

### 14.1 经济平衡目标

| 阶段 | 周数 | 目标现金 | 目标周利润 |
|------|------|----------|------------|
| 新手期 | 1~12 | 50,000~150,000 | -5,000~5,000 |
| 成长期 | 13~52 | 100,000~500,000 | 5,000~20,000 |
| 稳定期 | 53~156 | 300,000~2,000,000 | 15,000~50,000 |
| 扩张期 | 157+ | 1,000,000+ | 50,000+ |

---

## 15. 待确定事项

> 以下内容需要进一步讨论确定

- [ ] 初始启动资金具体数值
- [ ] 每种店铺类型的详细数值表
- [ ] 品牌数据库（加盟品牌列表）
- [ ] 事件池完整内容
- [ ] 成就完整列表
- [ ] 广告奖励具体数值
- [ ] 数值平衡测试与调整
- [ ] 多店经营时的玩家精力分配机制
- [ ] 继承系统的详细流程
- [ ] 世界事件的具体触发概率和影响数值
