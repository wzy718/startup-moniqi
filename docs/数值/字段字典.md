# 数值数据表字段字典（对齐 `docs/数值/*.csv`）

> 本文件用于把“CSV 表结构”与“数值系统口径”绑定起来，避免文档与数据各写一套导致不一致。
>
> 统一口径、结算顺序与公式见：`docs/数值/数值类型.md`

---

## 通用约定

- 分隔符：
  - `required_flags/excluded_flags/suitable_types/required_for/optional_for` 等字段用 `|` 分隔多个 token
- JSON 字段：
  - 约定：以 `_json` 结尾的列，其单元格内容是 **JSON 字符串**（对象/数组）
  - CSV 转义：JSON 内部的双引号在 CSV 中需要写成 `""`（示例见 `docs/数值/*_new_schema_sample.csv`）
- 空值语义：
  - 对“筛选条件类字段”（如 `shop_type/operation_mode/season`）而言，空值表示**不限**
- 布尔：
  - 文档口径建议统一使用 `true/false`
  - 若策划侧需要 Excel 友好，也允许用 `0/1` 表示布尔（解析时兼容）
- 金额：
  - 单位：元；建议整数
- 概率/倍率：
  - 概率建议 `0~1`；倍率建议以 `1.0` 为基准（例如 `1.15` 表示 +15%）

---

## `shop_types.csv`（店铺类型配置）

- 主键：`type_id`
- 用途：开局可选店铺类型、基础成本/毛利/客单/人员与面积约束

字段说明（节选）：
- `startup_cost_min/startup_cost_max`：开店启动成本区间（元）
- `daily_cost_base`：日常基础成本（用于构建 `monthly_utility_cost/monthly_other_cost` 的基线）
- `gross_margin`：毛利率（用于结算 `cogs = revenue × (1 - gross_margin)`）
- `avg_ticket_min/avg_ticket_max`：客单价范围（元）
- `min_staff/ideal_staff`：人员下限/理想值（用于影响效率、压力、评分等）
- `min_area/ideal_area`：面积下限/理想值（用于匹配门面）
- `season_effect`：季节偏好（当前为字符串，建议后续结构化）

---

## `brands.csv`（加盟品牌配置）

- 主键：`brand_id`
- 外键：`brand_type` -> `shop_types.csv:type_id`

字段说明（节选）：
- `franchise_fee`：一次性加盟费（开局/扩张时扣除现金）
- `royalty_rate`：按营业额抽成比例（如使用，建议计入“外卖/平台之外”的另一条抽成线）
- `monthly_fee`：固定月费（映射到 `shop.monthly_brand_fee`）
- `territory_protection`：区域保护（影响竞争事件/门店生成）
- `menu_freedom/support_level`：玩法向指标（影响事件选项/数值修正）

---

## `locations.csv`（位置类型配置）

- 主键：`location_id`
- 用途：门面生成与选址差异

字段说明（节选）：
- `rent_multiplier`：租金倍率（用于生成门面 `monthly_rent`）
- `traffic_multiplier`：人流倍率（用于生成 `foot_traffic` 或直接影响 `daily_customers`）
- `competition_base`：基础竞争强度（用于生成 `competition_index`）
- `weekday_modifier/weekend_modifier/holiday_modifier`：不同日期类型的客流系数
- `suitable_types`：适合的店铺类型（`all` 或 `milk_tea|cafe` 这类）
- `core_spot_chance/poor_spot_chance`：生成门面点位优劣（`spot_tier`）为 core/poor 的概率（剩余概率为 normal）
- `core_rent_mult/core_traffic_mult`：core 点位对租金/客流的倍率修正
- `poor_rent_mult/poor_traffic_mult`：poor 点位对租金/客流的倍率修正

---

## `positions.csv`（岗位配置）

- 主键：`position_id`
- 用途：招聘池、薪资区间、岗位对店铺指标的影响权重

字段说明（节选）：
- `salary_min/salary_max`：月薪范围（元）
- `impact_quality/impact_service/impact_hygiene/impact_efficiency`：对经营指标的影响权重（建议统一 0~1）
- `can_manage`：是否可托管（影响玩家压力/多店玩法）
- `required_for/optional_for`：岗位在不同店铺类型的必需/可选关系

---

## `events.csv`（事件定义，新表头 v1）

- 主键：`event_id`
- 用途：每周事件抽取与展示文案

字段说明（节选）：
- `title/description`：展示文本（事件“题目/正文”）
- `scene_json`：场景列表（数组），用于 UI 分组/筛选（例如 `["老街铺","写字楼店"]`）
- `is_absurd_menu`：是否“荒诞菜单/特殊入口”（布尔，兼容 `0/1`）
- `tags_json`：事件标签（数组），用于分类与权重规则（例如 `["投诉","日常"]`）
- `pools_json`：事件池归属（数组）
  - 每个元素形如 `{ "bag_id": "early_daily", "stage_min": 1, "stage_max": 3, "weight": 1.0 }`
  - 用于决定“在哪些袋子里出现、在哪些阶段可出现、基础权重是多少”
- `conditions_json`：触发条件（对象），用于过滤候选事件
  - 范围类条件统一用 `[min,max]`（闭区间），例如 `"week":[1,999]`、`"cash":[0,200000]`
  - 列表类条件建议用数组，例如 `"shop_type_in":["ALL","milk_tea"]`
  - flags 条件建议拆成三类：`required_flags_all` / `required_flags_any` / `excluded_flags_any`
- `occurrence_json`：出现/次数控制（对象），用于限制重复出现
  - `cooldown_turns`：冷却周数；`max_total`：总次数上限（`-1` 表示不限）
  - `max_per_stage`：每阶段上限；`once_only`：是否全局仅一次
- `weight_rules_json`：权重修正规则（数组），用于根据状态动态调整抽取权重
  - 每个元素形如 `{ "when": {...}, "op":"mul", "value":1.3 }`（`when` 语法与 `conditions_json` 同口径）
- `meta_json`：策划元信息（对象），例如 `version/author/notes`（不参与数值）

---

## `choices.csv`（事件选项，新表头 v1）

- 主键建议：`choice_uid`（或复合主键 `(event_id, choice_code)`）
- 外键：`event_id` -> `events.csv:event_id`
- 用途：事件选项展示、可见性、检定方式与结果效果（以 `outcomes_json.effects` 为准）

字段说明（节选）：
- `choice_code`：同一事件内的选项代号（例如 `A/B/C`）
- `choice_text`：选项文本
- `visibility_json`：可见性条件（对象；口径与 `events.csv:conditions_json` 一致），用于“显示/隐藏选项”
- `resolution_json`：检定方式（对象）
  - 示例：`{ "type":"prob", "success_rate":0.6 }`（`success_rate` 为 `0~1`）
  - `type` 允许后续扩展（例如 skill_check/compare 等），但需要实现统一解释器
- `outcomes_json`：结果与效果（对象）
  - 结构建议：`{ "success":{ "text":"...", "effects":[...] }, "fail":{...} }`
  - `effects` 为数组；每个 effect 至少包含：
    - `scope`：作用域（例如 `stat` / `flag` / `bag_weight` / `event_weight`）
    - `target`：目标（字符串或对象；例如 `stat` 的 `cash/reputation`，`bag_weight` 的 `{bag_id}`）
    - `op`：操作（例如 `add`/`mul`）
    - `value`：数值（金额建议整数；概率/倍率用浮点）
    - `duration_turns`：持续周数（可选；不填表示一次性）
- `tags_json`：选项标签（数组），用于 UI/统计/权重规则
- `meta_json`：策划元信息（对象），例如 `version/ui_hint/notes`

---

## `world_events.csv`（世界事件）

- 主键：`event_id`
- 用途：跨多周的全局/区域/品类影响

字段说明（节选）：
- `probability`：触发概率（建议以“每周检定”的口径理解）
- `duration_min/duration_max`：持续周数（`-1` 表示永久）
- `dine_in_traffic_mult/delivery_traffic_mult`：堂食/外卖客流倍率（默认 `1.0`）
- `avg_ticket_mult`：客单价倍率（默认 `1.0`）
- `labor_cost_mult`：人工成本倍率（默认 `1.0`，用于政策性成本上涨）
- `cogs_cost_mult`：原料/损耗成本倍率（默认 `1.0`，用于供应链危机）
- `weekly_fixed_cost_add`：每周固定额外成本（如防疫）
- `one_time_cost_add`：一次性成本（如修理费）
- `forced_close_chance/shop_damage_chance`：强制关店/店铺受损概率（如使用）
- `rating_delta`：评分加成（例如网红潮）
- `competition_index_delta/category_trust_delta`：竞争指数/品类信任变化
- `world_flags_add`：附加世界标记（`|` 分隔），用于开关特殊逻辑（如 `chaos_mode`）
- `traffic_modifier/cost_modifier/special_effect`：**旧字段（legacy）**，保留便于回溯；建议实现优先使用结构化字段
- `trigger_condition`：形如 `week>20`、`cash>200000`、`rating>4.0`、`location=street`（建议后续结构化）

规则定义见：`docs/数值/世界事件规则.md`

---

## `achievements.csv`（成就）

- 主键：`achievement_id`
- 用途：分享节点、解锁、奖励

字段说明（节选）：
- `condition_type/condition_value`：达成条件（建议由代码统一解释器解析）
- `reward_type/reward_value`：奖励类型与数值
- `hidden`：隐藏成就
- `tier/icon`：展示用

规则定义见：`docs/数值/成就规则.md`

---

## `mbti.csv`（MBTI 数值）

- 主键：`mbti`
- 用途：开局 delta 与回合内修正

字段说明（节选）：
- `delta_*`：开局一次性加成（加法）
- `social_success/stress_recovery/...`：倍率字段（默认 1.0，乘法叠加）
- `hire_speed`：建议解释为“招聘耗时减少周数”的加法项（例如 `hire_time -= hire_speed`，下限 clamp 到 0）
- `special_effect`：字符串效果标记（可解锁事件选项或触发特殊规则）
