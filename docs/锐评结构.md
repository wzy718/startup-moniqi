> 目标：通过采集餐饮创业项目的成本、营收与关键假设，计算财务可行性，并生成可传播的“锐评式”结论与改进建议。  
> 核心原则：**财务计算引擎（确定性）优先，大模型负责追问与表达**。

---

## 1. 背景与目标

### 1.1 用户痛点
- 创业者拿到的“总部样板店数据/招商话术”缺乏可核验口径
- 成本项遗漏常见（人工、平台抽佣、促销补贴、折旧、现金流缓冲）
- 需要快速得到：**能不能做、为什么、该怎么改、需要补哪些信息验证**

### 1.2 产品目标（MVP）
- 用表单/对话收集关键数据（≤3分钟可跑出初版结论）
- 输出结构化财务结果（盈亏平衡、净利润、回本周期、现金缓冲月数）
- 输出“锐评”报告（固定模板：一句话结论 + 三刀见血 + 三条建议 + 风险提示）
- 支持缺失字段追问（引导补齐关键假设，而不是硬给结论）

### 1.3 非目标（v0.1不做）
- 不做法律/合同审查（只做风险提示）
- 不做投资建议/收益承诺
- 不做复杂门店排班/供应链优化（只给方向性建议）

---

## 2. 用户与场景

### 2.1 目标用户
- 餐饮创业新手：加盟/自营开店评估
- 正在经营但亏损：想定位问题（房租/人工/毛利/平台）
- 餐饮顾问/招商主管：需要标准化评估输出

### 2.2 典型使用路径
1) 进入小程序 → 选择「快速评估」  
2) 填写/对话补齐：投入、租金、人工、营收假设、平台&毛利等  
3) 生成：财务结果 + 锐评报告 + 场景分析（保守/基准/乐观）  
4) 一键分享（海报/长图/链接）与“继续追问完善”

---

## 3. 功能需求（FRD）

### 3.1 数据采集
#### 3.1.1 采集方式
- 表单模式（默认）：分步问卷（每步≤5题）
- 对话模式（可选）：用户用自然语言描述，Agent 追问补齐字段

#### 3.1.2 字段分组（v0.1）
- 一次性投入（加盟费/装修/设备/押金/开业物料/流动资金）
- 收入假设（堂食/外卖：日均单量、客单价、月营业天数）
- 变动成本（食材成本率、平台抽佣率、包材、促销补贴、其他变动）
- 固定成本（房租+物业、人工、能耗、折旧、总部持续费用、营销固定）
- 融资（可选：贷款利息/还款）
- 风险项（可选：强制供货、保护距离、合同违约金、选址可控性）
- 同意与授权（必填：隐私与数据使用；若有连线录制/语音需另签）

#### 3.1.3 缺失字段追问策略（关键项优先级）
P0（缺失则不出“能做/别做”结论，只出“需要补齐”）：
- 月营业天数
- 日均单量（至少一个渠道）
- 客单价（至少一个渠道）
- 房租（月）
- 人工（月）
- 食材成本率或单均食材成本

P1（可缺失但会降低置信度）：
- 平台抽佣/配送费（外卖）
- 促销补贴/包材
- 折旧/持续加盟费/系统费
- 现金储备（月数）

### 3.2 财务计算引擎（确定性）
> 统一单位：人民币（CNY），时间粒度：月

#### 3.2.1 基础公式（基准场景）
**月营收**
- `rev_channel = orders_per_day * aov * open_days_per_month`
- `monthly_revenue = Σ rev_channel`

**月变动成本**
- 对每个渠道（堂食/外卖）：
  - `var_cost_rate_base = cogs_rate + packaging_rate + promo_rate + other_variable_rate`
  - 外卖额外加：`platform_rate`（抽佣/技术服务费等）
  - `var_cost_channel = rev_channel * (var_cost_rate_base + platform_rate_if_delivery)`
- `monthly_variable_cost = Σ var_cost_channel + variable_cost_fixed_amount`（可选：按月固定的“变动项”）

**贡献毛利**
- `contribution_margin = monthly_revenue - monthly_variable_cost`
- `contribution_margin_rate = contribution_margin / monthly_revenue`（月营收为0时置0）

**月固定成本**
- `fixed_cost = rent_total + labor_total + utilities + royalties + marketing_fixed + other_fixed + depreciation`

**月经营利润**
- `operating_profit = contribution_margin - fixed_cost`

**盈亏平衡月营收**
- `breakeven_revenue = fixed_cost / contribution_margin_rate`（贡献毛利率≤0时：返回 null，并标红）

**回本周期（月）**
- `upfront_investment = Σ one_time_costs`
- `operating_cashflow = operating_profit + depreciation - loan_principal_payment`（若不做贷款则忽略后两项）
- `payback_months = upfront_investment / operating_cashflow`（≤0则为 null）

**现金缓冲（月）**
- `cash_buffer_months = cash_reserve / fixed_cost`（fixed_cost=0则 null）

#### 3.2.2 场景分析（3档）
- 保守：营收 × 0.7（或单量×0.7）
- 基准：用户输入
- 乐观：营收 × 1.1  
输出每档：净利润、盈亏平衡达成与否、回本估计（若可算）

### 3.3 锐评生成（LLM表达层）
#### 3.3.1 输出结构（固定栏目）
1) **一句话结论**：能做 / 谨慎 / 别做（附关键阈值理由）
2) **三刀见血**：3个最致命数字（例：盈亏平衡、净利润、回本）
3) **三条可执行建议**：分别针对「降固定 / 提毛利 / 验证假设」
4) **风险提示与免责声明**：基于输入与假设；不构成投资/法律意见

#### 3.3.2 结论分档（建议规则）
- **别做（NO_GO）**：
  - 贡献毛利率 ≤ 0 或无法算盈亏平衡
  - 基准场景月经营利润为负，且保守/基准均为负
  - 盈亏平衡所需日均单量 >（用户输入日均单量 × 1.5）且无明显提振路径
- **谨慎（CAUTION）**：
  - 基准略正但保守为负
  - 回本周期 > 24个月（可配置）
  - 现金缓冲 < 2个月
- **能做（GO）**：
  - 基准与保守均为正（或保守接近打平）
  - 回本周期 ≤ 18个月（可配置）
  - 现金缓冲 ≥ 3个月

> 阈值全部做成可配置参数（config），便于你调“嘴毒程度”。

### 3.4 报告与分享
- 报告页面：结构化财务 + 锐评正文 + 场景对比表
- 分享：生成长图/海报（v0.1可先做“复制文本+分享链接”）

### 3.5 数据与合规
- 必须：隐私政策、用户数据使用同意（勾选）
- 可选：如涉及语音/直播素材，需单独授权与脱敏流程（不在 v0.1 强依赖）
- 存储：保存用户输入与计算结果；对话文本可选保存（建议默认脱敏）

---

## 4. 页面与交互（MVP）

### 4.1 页面清单
1) 首页：快速评估 / 对话评估 / 历史报告  
2) 问卷页：分步填写（支持“我不知道”）  
3) 结果页：结论卡片 + 关键指标 + 场景对比 + 锐评正文  
4) 追问页：列出缺失P0字段，逐条补齐并刷新结果  
5) 设置页：阈值偏好（保守/激进）、是否保存对话、数据导出  

### 4.2 关键交互
- 任何字段变化 → 重新计算（本地/云函数均可）
- 若P0缺失：结果页显示“无法给结论”，展示需要补齐清单
- 结果页提供“用更保守假设再算一次”按钮

---

## 5. 系统架构与接口

### 5.1 建议架构
- 小程序前端：表单、结果展示、分享
- 云函数/后端（必需）：
  - `calc_engine`：纯计算（可单测）
  - `llm_service`：生成锐评（输入为结构化结果 + 少量原始字段）
  - `storage`：记录评估请求、结果、版本号

### 5.2 接口（示例）
- `POST /v1/evaluate`：输入项目数据 → 输出财务结果 + 缺失字段
- `POST /v1/generate_review`：输入财务结果 → 输出锐评文本（可带风格参数）
- `POST /v1/chat`（可选）：对话追问补齐字段 → 返回结构化更新

---

## 6. 埋点与指标（MVP）
- 完成率：开始评估→出结果
- P0字段补齐率
- 分享率（分享按钮点击/成功）
- 回访率（历史报告打开）
- “你说得准”反馈（thumb up/down）

---

## 7. 风控与边界
- 输出必须包含免责声明（模板固定）
- 不允许输出针对个人的辱骂/歧视（只攻击商业假设与数字）
- 对明显异常输入（如成本率>100%）要提示并要求确认

---

# JSON Schema（Draft 2020-12）

> 你可以把它当作后端 `POST /v1/evaluate` 的请求/响应契约。  
> 说明：字段尽量“可选但有优先级”，以支持缺失追问。

---

## 1) 请求：EvaluationRequest.schema.json

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/EvaluationRequest.schema.json",
  "title": "EvaluationRequest",
  "type": "object",
  "additionalProperties": false,
  "required": ["meta", "project", "revenue", "variable_costs", "fixed_costs", "one_time_costs", "consent"],
  "properties": {
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["schema_version", "currency", "timezone", "source"],
      "properties": {
        "schema_version": { "type": "string", "default": "0.1.0" },
        "currency": { "type": "string", "enum": ["CNY"], "default": "CNY" },
        "timezone": { "type": "string", "default": "Asia/Tokyo" },
        "source": { "type": "string", "enum": ["miniapp_form", "miniapp_chat", "admin_import"] },
        "request_id": { "type": "string" },
        "created_at": { "type": "string", "format": "date-time" }
      }
    },
    "project": {
      "type": "object",
      "additionalProperties": false,
      "required": ["business_type", "city_tier"],
      "properties": {
        "project_name": { "type": "string" },
        "business_type": { "type": "string", "enum": ["franchise", "self_operated", "unknown"], "default": "unknown" },
        "category": { "type": "string", "description": "如：茶饮/快餐/烧烤/烘焙" },
        "city": { "type": "string" },
        "city_tier": { "type": "string", "enum": ["T1", "T2", "T3", "T4", "T5_or_below", "unknown"], "default": "unknown" },
        "store_area_sqm": { "type": "number", "minimum": 0 },
        "seats": { "type": "integer", "minimum": 0 },
        "notes": { "type": "string" }
      }
    },
    "revenue": {
      "type": "object",
      "additionalProperties": false,
      "required": ["open_days_per_month", "channels"],
      "properties": {
        "open_days_per_month": { "type": "integer", "minimum": 1, "maximum": 31 },
        "channels": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["channel", "orders_per_day", "aov"],
            "properties": {
              "channel": { "type": "string", "enum": ["dine_in", "delivery", "takeaway", "other"] },
              "orders_per_day": { "type": "number", "minimum": 0 },
              "aov": { "type": "number", "minimum": 0, "description": "客单价" },
              "revenue_override_monthly": { "type": "number", "minimum": 0, "description": "若用户直接提供该渠道月营收，可覆盖计算" }
            }
          }
        }
      }
    },
    "variable_costs": {
      "type": "object",
      "additionalProperties": false,
      "required": ["cogs_rate"],
      "properties": {
        "cogs_rate": { "type": "number", "minimum": 0, "maximum": 1, "description": "食材成本率（0~1）" },
        "packaging_rate": { "type": "number", "minimum": 0, "maximum": 1, "default": 0, "description": "包材成本率（0~1）" },
        "promo_rate": { "type": "number", "minimum": 0, "maximum": 1, "default": 0, "description": "促销补贴率（0~1）" },
        "other_variable_rate": { "type": "number", "minimum": 0, "maximum": 1, "default": 0 },
        "platform_rate_delivery": { "type": "number", "minimum": 0, "maximum": 1, "default": 0, "description": "外卖平台抽佣/技术服务费率（0~1）" },
        "variable_cost_fixed_amount": { "type": "number", "minimum": 0, "default": 0, "description": "按月计的其他变动成本金额" }
      }
    },
    "fixed_costs": {
      "type": "object",
      "additionalProperties": false,
      "required": ["rent_total", "labor_total"],
      "properties": {
        "rent_total": { "type": "number", "minimum": 0, "description": "房租+物业等（月）" },
        "labor_total": { "type": "number", "minimum": 0, "description": "人工总成本（月，含社保）" },
        "utilities": { "type": "number", "minimum": 0, "default": 0, "description": "水电燃气（月）" },
        "depreciation": { "type": "number", "minimum": 0, "default": 0, "description": "折旧（月，现金流计算用）" },
        "royalties": { "type": "number", "minimum": 0, "default": 0, "description": "总部持续费用（月）" },
        "marketing_fixed": { "type": "number", "minimum": 0, "default": 0 },
        "other_fixed": { "type": "number", "minimum": 0, "default": 0 }
      }
    },
    "one_time_costs": {
      "type": "object",
      "additionalProperties": false,
      "required": ["total_upfront_investment"],
      "properties": {
        "total_upfront_investment": { "type": "number", "minimum": 0, "description": "一次性投入合计（可由明细求和或用户直填）" },
        "franchise_fee": { "type": "number", "minimum": 0, "default": 0 },
        "deposit": { "type": "number", "minimum": 0, "default": 0 },
        "fitout": { "type": "number", "minimum": 0, "default": 0, "description": "装修" },
        "equipment": { "type": "number", "minimum": 0, "default": 0 },
        "opening_materials": { "type": "number", "minimum": 0, "default": 0 },
        "initial_inventory": { "type": "number", "minimum": 0, "default": 0 },
        "working_capital": { "type": "number", "minimum": 0, "default": 0, "description": "流动资金/备用金" }
      }
    },
    "financing": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "loan_enabled": { "type": "boolean", "default": false },
        "loan_principal": { "type": "number", "minimum": 0 },
        "interest_rate_annual": { "type": "number", "minimum": 0, "maximum": 1 },
        "loan_term_months": { "type": "integer", "minimum": 1 },
        "principal_payment_monthly": { "type": "number", "minimum": 0, "description": "若已知每月还本金额可直填" }
      }
    },
    "cash": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "cash_reserve": { "type": "number", "minimum": 0, "description": "现金储备（可扛固定成本）" }
      }
    },
    "risk": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "forced_supply": { "type": "boolean" },
        "price_control": { "type": "boolean" },
        "mandatory_campaigns": { "type": "boolean" },
        "territory_protection": { "type": "boolean" },
        "exit_penalty": { "type": "boolean" },
        "notes": { "type": "string" }
      }
    },
    "consent": {
      "type": "object",
      "additionalProperties": false,
      "required": ["privacy_accepted"],
      "properties": {
        "privacy_accepted": { "type": "boolean" },
        "data_usage_accepted": { "type": "boolean", "default": false, "description": "同意用于模型优化/训练（可选）" },
        "timestamp": { "type": "string", "format": "date-time" },
        "version": { "type": "string", "description": "同意版本号，如 privacy_v1.0" }
      }
    }
  }
}
2) 响应：EvaluationResponse.schema.json
json
始终显示详情

复制代码
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/EvaluationResponse.schema.json",
  "title": "EvaluationResponse",
  "type": "object",
  "additionalProperties": false,
  "required": ["meta", "computed", "verdict", "missing_fields", "flags"],
  "properties": {
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["schema_version", "request_id", "computed_at"],
      "properties": {
        "schema_version": { "type": "string", "default": "0.1.0" },
        "request_id": { "type": "string" },
        "computed_at": { "type": "string", "format": "date-time" },
        "engine_version": { "type": "string", "description": "calc_engine版本号" }
      }
    },
    "computed": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "monthly_revenue",
        "monthly_variable_cost",
        "contribution_margin",
        "contribution_margin_rate",
        "fixed_cost",
        "operating_profit",
        "breakeven_revenue",
        "payback_months",
        "cash_buffer_months"
      ],
      "properties": {
        "monthly_revenue": { "type": "number" },
        "monthly_variable_cost": { "type": "number" },
        "contribution_margin": { "type": "number" },
        "contribution_margin_rate": { "type": "number", "minimum": 0, "maximum": 1 },
        "fixed_cost": { "type": "number" },
        "operating_profit": { "type": "number" },
        "operating_cashflow": { "type": "number", "description": "profit + depreciation - principal_payment" },
        "breakeven_revenue": { "type": ["number", "null"], "description": "贡献毛利率<=0时为null" },
        "breakeven_orders_per_day_est": {
          "type": ["number", "null"],
          "description": "按综合客单价粗估的盈亏平衡日单量（可选）"
        },
        "payback_months": { "type": ["number", "null"] },
        "cash_buffer_months": { "type": ["number", "null"] }
      }
    },
    "scenarios": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["name", "revenue_multiplier", "operating_profit", "payback_months"],
        "properties": {
          "name": { "type": "string", "enum": ["conservative", "base", "optimistic"] },
          "revenue_multiplier": { "type": "number" },
          "operating_profit": { "type": "number" },
          "payback_months": { "type": ["number", "null"] }
        }
      }
    },
    "verdict": {
      "type": "object",
      "additionalProperties": false,
      "required": ["level", "confidence", "one_liner"],
      "properties": {
        "level": { "type": "string", "enum": ["GO", "CAUTION", "NO_GO", "NEED_MORE_INFO"] },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
        "one_liner": { "type": "string" },
        "key_numbers": {
          "type": "array",
          "minItems": 0,
          "maxItems": 5,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["label", "value"],
            "properties": {
              "label": { "type": "string" },
              "value": { "type": "string" }
            }
          }
        }
      }
    },
    "missing_fields": {
      "type": "array",
      "description": "用于追问补齐",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["field_path", "priority", "question"],
        "properties": {
          "field_path": { "type": "string", "description": "JSONPath-like，如 revenue.open_days_per_month" },
          "priority": { "type": "string", "enum": ["P0", "P1", "P2"] },
          "question": { "type": "string" }
        }
      }
    },
    "flags": {
      "type": "array",
      "description": "红旗/黄旗提示",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["code", "severity", "message"],
        "properties": {
          "code": { "type": "string" },
          "severity": { "type": "string", "enum": ["info", "warning", "danger"] },
          "message": { "type": "string" },
          "suggestion": { "type": "string" }
        }
      }
    },
    "review": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "title": { "type": "string" },
        "sections": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["type", "text"],
            "properties": {
              "type": { "type": "string", "enum": ["verdict", "three_hits", "three_actions", "disclaimer"] },
              "text": { "type": "string" }
            }
          }
        }
      }
    }
  }
}
3) 示例请求（最小可跑）
json
始终显示详情

复制代码
{
  "meta": {
    "schema_version": "0.1.0",
    "currency": "CNY",
    "timezone": "Asia/Tokyo",
    "source": "miniapp_form",
    "request_id": "req_20251216_0001",
    "created_at": "2025-12-16T10:00:00+09:00"
  },
  "project": {
    "business_type": "franchise",
    "city_tier": "T2",
    "category": "茶饮",
    "store_area_sqm": 35
  },
  "revenue": {
    "open_days_per_month": 30,
    "channels": [
      { "channel": "dine_in", "orders_per_day": 120, "aov": 18 },
      { "channel": "delivery", "orders_per_day": 60, "aov": 22 }
    ]
  },
  "variable_costs": {
    "cogs_rate": 0.35,
    "packaging_rate": 0.03,
    "promo_rate": 0.05,
    "platform_rate_delivery": 0.18
  },
  "fixed_costs": {
    "rent_total": 18000,
    "labor_total": 26000,
    "utilities": 3500,
    "depreciation": 2500,
    "royalties": 1500
  },
  "one_time_costs": {
    "total_upfront_investment": 280000,
    "franchise_fee": 60000,
    "fitout": 120000,
    "equipment": 70000,
    "deposit": 20000,
    "working_capital": 10000
  },
  "cash": { "cash_reserve": 60000 },
  "consent": {
    "privacy_accepted": true,
    "data_usage_accepted": false,
    "timestamp": "2025-12-16T10:00:00+09:00",
    "version": "privacy_v1.0"
  }
}