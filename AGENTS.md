# AGENTS.md（中文指引）

本文件用于约束/指导 AI 代理在本仓库内的工作方式与口径，适用于仓库根目录及其所有子目录（除非子目录存在更具体的 `AGENTS.md` 覆盖）。

## 项目概述
- **项目类型**：微信小游戏
- **引擎版本**：Cocos Creator `3.8.8`
- **语言**：TypeScript
- **定位**：文字模拟经营类（参考《纸上谈亲》《摆摊模拟器》）

## 沟通与文档
- 与用户沟通使用中文。
- **所有代码注释与项目文档使用中文**。
- **变量名/函数名/类名使用英文**（清晰、可读、避免缩写滥用）。
- 每次改动前后，优先用简短中文说明：改动目的、影响面、验证方式。

## 变更原则（重要）
- 优先理解并遵循 `docs/` 下的设计与数值文档，再动手改代码。
- 修复根因，避免“补丁式”绕过；同时保持改动最小化，避免无意义的全局格式化/重排。
- 不要修改与目标无关的文件；不要引入不必要的新依赖。
- **不要执行 `git commit`**，除非用户明确要求。

## 数值口径（必须一致）
- **时间单位**：`1` 回合 = `1` 周。
- **金额单位**：元，使用**整数**存储与结算（展示再做格式化）。
- **概率/倍率**：概率使用 `0~1` 小数；倍率如 `1.1` 表示 `+10%`。
- **月成本折算**：统一使用 `WEEKS_PER_MONTH = 4`（游戏口径）。
- **状态分类**：
  - **存档值（state）**：需要持久化（如 `cash`、`stress`、店铺/员工列表）。
  - **派生值（derived）**：由存档值计算得出，避免落库（如 `weekly_profit`、`total_asset`）。

## 回合结算顺序（必须遵守）
1. 回合开始：读取存档值
2. 生成事件候选：按规则过滤并抽取
3. 玩家选择与检定：根据成功率/条件应用效果
4. 经营结算：逐店计算收入、成本、利润
5. 玩家结算：汇总利润，扣除生活费、利息等
6. 状态结算：更新压力、健康、精力等
7. 时间推进：`current_week += 1`
8. 死亡/破产判定

## 目录与文件约定
- `cocos/`：Cocos Creator 工程（脚本通常位于 `cocos/assets/`）
- `docs/`：需求/规则/数值文档（优先参考）
  - `docs/数值/数值类型.md`：数值系统核心口径
  - `docs/数值/字段字典.md`：数据字段含义
  - `docs/数值/*.csv`：事件、选择、成就等数据表
  - `docs/prd/理念.md`：设计理念

## 生成目录（默认不要手改）
除非用户明确要求或确有必要，否则避免直接修改这些目录下的产物文件，以免造成无意义的大 diff：
- `cocos/library/`
- `cocos/temp/`
- `cocos/profiles/`
- `cocos/settings/`

## 验证与自检
- 改动脚本后，建议用 Cocos Creator 打开 `cocos/` 工程，确保 TypeScript 编译无报错并能正常预览运行。
- 若涉及数值/结算逻辑，优先补齐可复现的输入输出示例，覆盖边界情况（破产、极端概率、负数保护等）。
